(()=>{"use strict";const e=(e,...s)=>{const i=document.createElement(e),r=s.map(e=>e instanceof HTMLElement?e:e instanceof Attr?t(i,e):e instanceof n?i.addEventListener(e.type,e.callback):e?.constructor===Object?o(i,e):"string"==typeof e?document.createTextNode(e):null==e?null:console.warn('unknown type given to function "tag": ',e)).filter(e=>null!=e);return i.replaceChildren(...r),i},t=(e,t)=>{if(e.hasAttribute(t.name)){const o=e.getAttribute(t.name);e.setAttribute(t.name,o+" "+t.value)}else e.setAttributeNode(t.cloneNode())},o=(e,t)=>{Object.keys(t).forEach(o=>{const n=t[o]instanceof Array?t[o].join(" "):t[o];if(e.hasAttribute(o)){const t=e.getAttribute(o);e.setAttribute(o,t+" "+n)}else e.setAttribute(o,n)})};class n{constructor(e,t){this.type=e,this.callback=t}}const s=(e,t)=>new n(e,t),i=(...t)=>e("a",...t),r=(...t)=>e("code",...t),c=(...t)=>e("fieldset",...t),a=(...t)=>e("hr",...t),l=(...t)=>e("input",...t),d=(...t)=>e("label",...t),u=(...t)=>e("legend",...t),p=(...t)=>e("p",...t),b=(...t)=>e("pre",...t),m=(...t)=>e("td",...t),f=(...t)=>e("tr",...t),h=(...t)=>e("output",...t),g=(...t)=>e("samp",...t),k=["wss://ws.vi-server.org/mirror"],v=((...t)=>e("datalist",...t))({id:"connection-options"},...k.map(t=>((...t)=>e("option",...t))({value:t}))),y=l({type:"text",id:"connection",list:v.id,placeholder:k[0]}),w=l({type:"text",id:"message"}),A=(...t)=>((...t)=>e("button",...t))({type:"button"},...t),S=A("Connect",{id:"connect-button"}),E=A("Disconnect",{id:"disconnect-button"}),C=A("Send",{id:"send-button"}),L=h({id:"outgoing"}),P=h({id:"incoming"}),D=h({id:"status"});let W=null;const M=()=>{D.setAttribute("type","open")},N=e=>{P.prepend(b(r(e.data)),a())},O=()=>{D.setAttribute("type","closed"),W=null},j=()=>{D.setAttribute("type","failed"),W=null},I=e=>{const t=e.target,o=e.type,n="keydown"===o?e.key:null;switch(!0){case t===y&&"Enter"===n:case t===S&&"click"===o:if(y.value)try{W=new WebSocket(y.value),D.setAttribute("type","loading"),W.addEventListener("open",M),W.addEventListener("message",N),W.addEventListener("close",O),W.addEventListener("error",j)}catch(e){console.error(e),D.setAttribute("type","failed")}break;case t===E&&"click"===o:W?.readyState===WebSocket.OPEN&&W.close();break;case t===w&&"Enter"===n:case t===C&&"click"===o:w.value&&W?.readyState===WebSocket.OPEN&&(W.send(w.value),L.prepend(b(r(w.value)),a()))}},z=[i("MDN Docs for WebSocket API",{href:"https://developer.mozilla.org/en-US/docs/Web/API/WebSocket"}),i("MDN Docs for CSS Grid",{href:"https://developer.mozilla.org/en-US/docs/Glossary/Grid"}),i("Blog post about Event Delegation",{href:"https://javascript.info/event-delegation"}),i("Plain HTML page on TCP sockets in C",{href:"https://www.cs.rpi.edu/~moorthy/Courses/os98/Pgms/socket.html"}),i("Stack overflow on reading from sockets in C",{href:"https://stackoverflow.com/questions/666601/what-is-the-correct-way-of-reading-from-a-tcp-socket-in-c-c"}),i("CLI tool for probing websockets",{href:"https://github.com/vi/websocat"})],T=[((...t)=>e("header",...t))(e("h1","Websocket Pertubation & Response"),p("A simple interface for making and probing websocket connections using the WebSocket API.")),((...t)=>e("main",...t))(((...t)=>e("form",...t))(s("click",I),s("keydown",I),c(u("Input"),d("Connection URL",{for:y.id}),y,v,S,E,a(),d("Connection status",{for:D.id}),D,a(),d("Message",{for:w.id}),w,C),c(u("Output"),((...t)=>e("table",...t))(f(m(d("Pertubation",{for:L.id}),{class:"nosmall"}),m(d("Response",{for:P.id}))),f(m(g(L),{class:"nosmall"}),m(g(P)))))),((...t)=>e("details",...t))(e("summary","Sources"),((...t)=>e("ul",...t))(...z.map(t=>((...t)=>e("li",...t))(t))))),((...t)=>e("footer",...t))(p("by Mozzie Dvorak // with ",i("Ellipsi",{href:"https://www.npmjs.com/package/ellipsi"})," // view ",i("page source",{href:"https://github.com/mdvorak340/mdvorak340.github.io/tree/main/ws"})))],x=()=>{document.body.replaceChildren(...T)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",x):x()})();